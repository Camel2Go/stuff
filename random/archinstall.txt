# ========== installation ===========

# setup
loadkeys de
ls /sys/firmware/efi/efivars
ping google.com
timedatectl set-ntp true

# partitioning
fdisk -l
fdisk
mkfs.ext4 /dev/sdXY
mkfs.fat -F 32 /dev/esp	# only on new creation!

# mount root and esp
mount /dev/sdXY /mnt
mount --mkdir /dev/sdXY /mnt/boot

# configure mirrors
curl "https://archlinux.org/mirrorlist/?country=DE&protocol=https&ip_version=4&ip_version=6" > /etc/pacman.d/mirrorlist
vim /etc/pacman.d/mirrorlist
> uncomment wanted mirrors

# install base
pacstrap /mnt 
	base 				# Minimal package set to define a basic Arch Linux installation
	linux				# The Linux kernel and modules
	linux-firmware		# Firmware files for Linux

# generate fstab file
genfstab -U /mnt >> /mnt/etc/fstab
cat /mnt/etc/fstab

# chroot to new system
arch-chroot /mnt

# install needed stuff
pacman -S 
	grub					# GNU GRand Unified Bootloader (2)
	efibootmgr				# Linux user-space application to modify the EFI Boot Manager
	dhcpcd					# RFC2131 compliant DHCP client daemon
	networkmanager			# Network connection manager and user applications
	networkmanager-openvpn	# NetworkManager VPN plugin for OpenVPN
	nss-mdns				# glibc plugin providing host name resolution via mDNS
	systemd-resolvconf		# systemd resolvconf replacement (for use with systemd-resolved)
	ntfs-3g					# NTFS filesystem driver and utilities
	exfat-utils				# Utilities for exFAT file system
	sudo					# Give certain users the ability to run some commands as root
	gnome					# gnome-desktop-environment + gnome-applications
	gnome-tweaks			# Graphical interface for advanced GNOME 3 settings (Tweak Tool)
	xdg-utils				# Command line tools that assist applications with a variety of desktop integration tasks
	firefox					# Standalone web browser from mozilla.org
	cups					# The CUPS Printing System - daemon package
	zsh						# A very advanced and programmable command interpreter (shell) for UNIX
	vim						# Vi Improved, a highly configurable, improved version of the vi text editor
	wget					# Network utility to retrieve files from the Web
	base-devel				# Basic developement-tools	
	cmake					# A cross-platform open-source make system
	git						# the fast distributed version control system
	net-tools				# Configuration tools for Linux networking
	wget 					# Network utility to retrieve files from the Web
	gnu-netcat				# GNU rewrite of netcat, the network piping application
	neofetch				# A CLI system information tool written in BASH that supports displaying images.
	tree					# A directory listing program displaying a depth indented list of files
	usbutils				# A collection of USB tools to query connected USB devices
	bat						# Cat clone with syntax highlighting and git integration
	fd						# Simple, fast and user-friendly alternative to find
	hexyl					# Colored command-line hex viewer
	fzf						# Command-line fuzzy finder
	lsd						# Modern ls with a lot of pretty colors and awesome icons
	plocate 				# Alternative to locate, faster and compatible with mlocate's database.
	bluez-utils				# Development and debugging utilities for the bluetooth protocol stack
	pacman-contrib			# ontributed scripts and tools for pacman systems
	qt5-wayland				# Provides APIs for Wayland
	thefuck					# Magnificent app which corrects your previous console command
	zsh-completions 		# Additional completion definitions for Zsh
	zsh-autosuggestions 	# Fish-like autosuggestions for zsh
	zsh-syntax-highlighting	# Fish shell like syntax highlighting for Zsh
	wl-clipboard			# Command-line copy/paste utilities for Wayland
	pkgfile					# a pacman .files metadata explorer





	
# Time
ln -sf /usr/share/zoneinfo/Europe/Berlin /etc/localtime
hwclock --systohc

# Localization
vim /etc/locale.gen
> uncomment "en_US.UTF-8 UTF-8" and "de_DE.UTF-8 UTF-8"
locale-gen
echo "LANG=de_DE.UTF-8" > /etc/locale.conf
echo "KEYMAP=de-latin1-nodeadkeys" > /etc/vconsole.conf

# Networking
echo "Camellaptop" > /etc/hostname
echo "172.0.0.1		localhost" >> /etc/hosts
echo "::1			localhost" >> /etc/hosts

/etc/NetworkManager/NetworkManager.conf
[ifupdown]
managed=true

vim /etc/nsswitch.conf
> hosts: mymachines mdns_minimal [NOTFOUND=return] resolve [!UNAVAIL=return] files myhostname dns mdns

# cups does not support systemd-resolved, rather needs avahi
(vim /etc/resolved.conf )
(> uncomment "MulticastDNS=yes")
(echo "[connection]" >> /etc/NetworkManager/conf.d/mdns.conf)
(echo "connection.mdns=2" >> /etc/NetworkManager/conf.d/mdns.conf)

# user-config
passwd
groupadd sudo
useradd -m -G sudo,storage,power -s /bin/zsh camel2go
passwd camel2go
visudo
> uncomment "%sudo ALL=(ALL:ALL) ALL"


# grub
pacman -S intel-ucode / amd-ucode
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=archlinux
vim /etc/default/grub
grub-mkconfig -o /boot/grub/grub.cfg

# services
systemctl enable gdm.service
systemctl enable NetworkManager.service
systemctl enable dhcpcd.service
systemctl enable cups.service
systemctl enable cups-browsed.service
systemctl enable bluetooth.service
systemctl enable systemd-resolved.service 

# done
exit
reboot


# ========= customization ===============

# wallpaper
> https://repository-images.githubusercontent.com/410301907/3126aefc-c58a-410b-9a85-5fed8ff0000d

> https://github.com/Jguer/yay
git clone https://aur.archlinux.org/yay.git
cd yay
makepkg -si

# remove some user-dirs
vim ~/.config/user-dirs.dirs

# link open to xdg-open
sudo ln -s /bin/xdg-open /bin/open

# pacman
vim /etc/pacman.conf
> uncomment Color
> uncomment ParallelDownloads = 5

# update pacman-databases
pacman -Sy
pacman -Fy
pkgfile --update

> https://ohmyz.sh
sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
~/.zshrc 

ZSH_THEME="agnoster"

# find plugins installed via pacman
ZSH_CUSTOM=/usr/share/zsh

# disable folder-background
export LS_COLORS=$LS_COLORS:'tw=00;33:ow=01;33:'

plugins=(	 
		adb
		command-not-found
		copyfile
		copypath
		fzf
		git
		sudo
		wd
		web-search
		zsh-autosuggestions
		zsh-interactive-cd
		zsh-syntax-highlighting
)

export EDITOR='vim'

alias ls="lsd"
alias cat="bat"
alias yeet="yay -Rs"
alias serve="python3 -m http.server"

# enable appindicators
yay libappindicator-gtk3

> https://github.com/ryanoasis/nerd-fonts
yay nerd-fonts-hack

> https://github.com/EliverLara/candy-icons
yay candy-icons

> https://github.com/nathanroark/tokyo-night-gnome-terminal
> change default theme in any way
bash -c "$(curl -fsSL https://raw.githubusercontent.com/nathanroark/tokyo-night-gnome-terminal/main/tokyo-night.sh)"

> https://github.com/Fausto-Korpsvart/Tokyo-Night-GTK-Theme
unzip -d ~/.themes Tokyonight-Dark-B.zip 
unzip -d ~/.config/gtk-4.0 Tokyonight-Dark-B-Gnome42.zip
mv ~/.config/gtk-4.0/Tokyonight-Dark-B.css ~/.config/gtk-4.0/gtk.css

~/.themes/Tokyonight-Dark-B/gnome-shell/gnome-shell.css
<<<<<<< Updated upstream
2285:
=======
2286:
>>>>>>> Stashed changes
#panel {
    > remove margin
    border: 0px solid #414868;
    border-bottom-width: 2px;
}
2599:
.popup-menu .popup-menu-content {
    margin: 4px 0px 12px;
}
~/.themes/Tokyonight-Dark-B/gtk-3.0/gtk.css
<<<<<<< Updated upstream
~/.themes/Tokyonight-Dark-B/gtk-3.0/gtk-dark.css
=======
>>>>>>> Stashed changes
> remove "-gtk-icon-source: transparent;"


> https://github.com/stronk-dev/Tokyo-Night-Linux
yay spotify
yay spicetify-cli
mkdir ~/.config/spicetify/Themes/tokionight
curl -o ~/.config/spicetify/Themes/tokionight/color.ini https://raw.githubusercontent.com/stronk-dev/Tokyo-Night-Linux/master/.config/spicetify/Themes/Base/color.ini
curl -o ~/.config/spicetify/Themes/tokionight/user.css https://github.com/stronk-dev/Tokyo-Night-Linux/blob/master/.config/spicetify/Themes/Base/user.css

# extensions
yay gnome-browser-connector
> https://extensions.gnome.org/extension/906/sound-output-device-chooser/
> https://extensions.gnome.org/extension/779/clipboard-indicator/
> https://extensions.gnome.org/extension/1460/vitals/
> https://extensions.gnome.org/extension/1401/bluetooth-quick-connect/
> https://extensions.gnome.org/extension/905/refresh-wifi-connections/
> https://extensions.gnome.org/extension/1010/archlinux-updates-indicator/
> https://extensions.gnome.org/extension/2917/bring-out-submenu-of-power-offlogout-button/
> https://extensions.gnome.org/extension/1238/time/
> https://extensions.gnome.org/extension/615/appindicator-support/

gnome-extensions-app
> enable "Launch new instance"
> enable "User Themes"
> Arch Linux Updates Indicator: 
	> gnome-terminal -- /bin/sh -c "yay; read _" 

gnome-tweaks
> Symbole = "Candy-Icons"
> Shell = "Tokionight-Dark-B"
> Veraltete Anwendungen = "Tokionight-Dark-B"

settings -> keyboard-shortcuts -> Fenster wechseln = Alt+Tab

================ GPU - Drivers ===============
> https://wiki.archlinux.org/title/Hardware_video_acceleration

> https://www.nvidia.com/de-de/geforce/drivers/
> find driver version (e.g. 515.65)
yay nvidia
> install corresponding drivers (extra/nvidia 515.65.01-14)

yay -S nvtop nvidia-settings libva-utils vdpauinfo xdg-desktop-portal-gnome
yay libva-nvidia-driver

========================= Wayland with Nvidia-Drivers ============================
> https://wiki.archlinux.org/title/GDM#Wayland_and_the_proprietary_NVIDIA_driver
> https://download.nvidia.com/XFree86/Linux-x86_64/515.48.07/README/xwayland.html

# add kernel parameter
/etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT="loglevel=3 quiet nvidia_drm.modeset=1"
sudo grub-mkconfig -o /boot/grub/grub.cfg

# add to initramfs (optional)
/etc/mkinitcpio.conf
MODULES=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)
sudo mkinitcpio -P

# enable Wayland (optional)
sudo systemctl enable nvidia-suspend.service nvidia-hibernate.service nvidia-resume.service 
echo "options nvidia NVreg_PreserveVideoMemoryAllocations=1" | sudo tee /etc/modprobe.d/nvidia-power-management.conf

gsettings set org.gnome.mutter experimental-features '["kms-modifiers"]'

------------------- firefox -----------------------
https://addons.mozilla.org/de/firefox/addon/h264ify/
about:config > media.ffmpeg.vaapi.enabled = true
~/.config/environment.d/envvars.conf
LIBVA_DRIVER_NAME=nvidia
MOZ_DISABLE_RDD_SANDBOX=1
MOZ_ENABLE_WAYLAND=1
EGL_PLATFORM=wayland

---------------------- OBS -------------------------
~/.config/environment.d/envvars.conf
QT_QPA_PLATFORM=wayland

--------------------- Electron ------------------------
# System-wide
~/.config/electron-flags.conf
--ozone-platform-hint=auto
--enable-features=WaylandWindowDecorations
(--enable-features=UseOzonePlatform --ozone-platform=wayland)
(--ignore-gpu-blocklist)
(--enable-gpu-rasterization)

# Discord
yay discord_arch_electron 
~/.config/discord-flags.conf

------------------- Status ---------------

echo $XDG_SESSION_TYPE
lspci -k | grep -A 2 -E "(VGA|3D)"
vainfo
vdpauinfo
nvtop
chromium > chrome://gpu/
firefox > about:support
MOZ_LOG="PlatformDecoderModule:5" firefox

================= msoffice =====================
> grab installer (might change user-agent)

/etc/pacman.conf
> enable multilib

yay -Sy wine wine-mono winetricks samba lib32-gnutls lib32-gst-plugins-base lib32-gst-plugins-good lib32-gstreamer lib32-libcups lib32-libpulse lib32-libxcomposite lib32-libxinerama

mkdir office356
WINEPREFIX=~/office356 WINEARCH=win32 wineboot -i
WINEPREFIX=~/office356 WINEARCH=win32 winetricks vcrun2019 msls31 msxml6 riched20 msftedit corefonts calibri allfonts (gdiplus)
WINEPREFIX=~/office356 WINEARCH=win32 regedit
> DWORD HKCurrentUser/Software/Wine/Direct2D/max_version_factory = 0
> DWORD HKCurrentUser/Software/Wine/Direct3D/MaxVersionGL = 30002
WINEPREFIX=~/office356 WINEARCH=win32 wine OfficeSetup.exe
cp ~/office356/drive_c/Program\ Files/Common\ Files/Microsoft\ Shared/ClickToRun/AppvIsvSubsystems32.dll ~/office356/drive_c/Program\ Files/Common\ Files/Microsoft\ Shared/ClickToRun/C2R32.dll ~/office356/drive_c/Program\ Files/Microsoft\ Office/root/Office16
cp ~/office356/drive_c/Program\ Files/Microsoft\ Office/root/vfs/ProgramFilesCommonX86/Microsoft\ Shared/OFFICE16/MSOXMLMF.DLL ~/office356/drive_c/Program\ Files/Common\ Files/Microsoft\ Shared/ClickToRun/msoxmlmf.dll

06c4:err:ole:apartment_add_dll couldn't load in-process dll L"C:\\Program Files\\Microsoft Office\\root\\VFS\\ProgramFilesCommonX86\\Microsoft Shared\\Office16\\MSOXMLMF.DLL"

WINEPREFIX=~/office356 WINEARCH=win32 wine uninstaller

0658:fixme:propsys:PSRegisterPropertySchema L"C:\\Program Files\\Microsoft Office\\root\\Office16\\Custom.propdesc" stub
0670:fixme:wevtutil:wmain stub: L"wevtutil.exe" L"im" L"C:\\ProgramData\\Microsoft\\ClickToRun\\{9AC08E99-230B-47e8-9721-4577B7F124EA}\\wordEtw.man" L"/rf:C:\\Program Files\\Microsoft Office\\root\\Office16\\wwlib.dll" L"/mf:C:\\Program Files\\Microsoft Office\\root\\Office16\\wwlib.dll"
0680:fixme:wevtutil:wmain stub: L"wevtutil.exe" L"im" L"C:\\ProgramData\\Microsoft\\ClickToRun\\{9AC08E99-230B-47e8-9721-4577B7F124EA}\\msoutilstat.etw.man" L"/rf:C:\\Program Files\\Microsoft Office\\root\\Office16\\msoetwres.dll" L"/mf:C:\\Program Files\\Microsoft Office\\root\\Office16\\msoetwres.dll"
0690:fixme:wevtutil:wmain stub: L"wevtutil.exe" L"im" L"C:\\ProgramData\\Microsoft\\ClickToRun\\{9AC08E99-230B-47e8-9721-4577B7F124EA}\\AirSpace.Etw.man" L"/rf:C:\\Program Files\\Microsoft Office\\root\\VFS\\ProgramFilesCommonX86\\Microsoft Shared\\Office16\\mso.dll" L"/mf:C:\\Program Files\\Microsoft Office\\root\\VFS\\ProgramFilesCommonX86\\Microsoft Shared\\Office16\\mso.dll"
06a0:fixme:wevtutil:wmain stub: L"wevtutil.exe" L"im" L"C:\\ProgramData\\Microsoft\\ClickToRun\\{9AC08E99-230B-47e8-9721-4577B7F124EA}\\wordEtw.man" L"/rf:C:\\Program Files\\Microsoft Office\\root\\Office16\\wwlib.dll" L"/mf:C:\\Program Files\\Microsoft Office\\root\\Office16\\wwlib.dll"
06b0:fixme:wevtutil:wmain stub: L"wevtutil.exe" L"im" L"C:\\ProgramData\\Microsoft\\ClickToRun\\{9AC08E99-230B-47e8-9721-4577B7F124EA}\\AirSpace.Etw.man" L"/rf:C:\\Program Files\\Microsoft Office\\root\\VFS\\ProgramFilesCommonX86\\Microsoft Shared\\Office16\\mso.dll" L"/mf:C:\\Program Files\\Microsoft Office\\root\\VFS\\ProgramFilesCommonX86\\Microsoft Shared\\Office16\\mso.dll"

C:\Program Files\Microsoft Office\Updates\Download\PackageFiles\B61A0176-B542-4FF7-A9F9-FE4EB6FA77DC\root\vfs\ProgramFilesCommonX86\Microsoft Shared\OFFICE16\AppvIsvSubsystems32.dll" L"\\?\C:\Program Files\Common Files\Microsoft Shared\ClickToRun\AppvIsvSubsystems32.dll